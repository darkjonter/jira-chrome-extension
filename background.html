<html>
<!-- Copyright 2010 andry.virvich@gmail.com. All Rights Reserved. -->
  <head>
	<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="js/soapclient.js"></script>
	<script type="text/javascript" src="js/xsddate.js"></script>
    <script type="text/javascript" src="js/filters.js"></script>
    <script type="text/javascript" src="js/loader.js"></script>
	<script>

	localStorage.setItem('updateinterval', localStorage.getItem('updateinterval')?localStorage.getItem('updateinterval'):600000)
	chrome.browserAction.setBadgeBackgroundColor({color: [0, 255,0, 255]})
	//localStorage.setItem('omniboxEnabled', (typeof localStorage.getItem('omniboxEnabled') == 'boolean')?localStorage.getItem('omniboxEnabled'):false);
	function Auth(){
		if(localStorage.getItem("url"))
		{
			loader.url = localStorage.getItem("url");
			loader.login(localStorage.getItem("username"), localStorage.getItem("password"), function(){
				loader.update();
			});
		} else {
		
			chrome.browserAction.setIcon({ 'path' : 'images/logo-19-off.png'});
			chrome.browserAction.setBadgeText({text: ''});
			loader.options();
		}
	}
	Auth();
	
	
			function AnimatedIcon(_src){
				this.src = _src;
				this.timer = null;
				this.canvas = document.createElement("canvas");
				document.body.appendChild(this.canvas);
				this.context = this.canvas.getContext('2d');
				this.image = new Image();
				this.image.src = this.src;
				chrome.browserAction.setIcon({path:this.src});
				var self = this;
				this.play = function(){
					this.deg = 0;
					this.timer = setInterval(function(){self.draw();}, 22);
				}
				this.draw = function(){
					this.context.clearRect(0, 0, this.image.width, this.image.height);
					this.context.translate(this.image.width/2,this.image.height/2);
					this.context.rotate(Math.PI * 15 / 180);
					this.context.translate(-this.image.width/2,-this.image.height/2);
					this.context.drawImage(this.image, 0, 0);
					chrome.browserAction.setIcon({
						imageData: this.context.getImageData(0, 0, this.image.width, this.image.height)
					});
					if((this.deg+=15) >= 360)
						this.stop();
				}
				
				this.stop = function(){
					clearInterval(this.timer);
					chrome.browserAction.setIcon({path:this.src});
				}
			}
		/*
		chrome.omnibox.onInputChanged.addListener(  function(text, suggest) {
			console.log(localStorage.getItem('omniboxEnabled') == 'true');
			if(localStorage.getItem('omniboxEnabled') == 'true'){
				loader.getIssuesFromTextSearchWithLimit(text, function(xhr){
					var data = [];
					$(xhr).find("multiRef").each(function(i, val) {
						if($("key", val).text()){
							data.push({
								content: $("key", val).text(),
								description: $("key", val).text() +": "+$("summary", val).text()
							})
						}
					});
					suggest(data);
				});
			}
		  });
		
		chrome.omnibox.onInputEntered.addListener(function(text) {
			if(localStorage.getItem('omniboxEnabled') == 'true'){
				loader.redirect(loader.url +"/browse/"+ text);
			}
		});	  
		  */
	</script>
 </head>
  <body></body>
</html> 