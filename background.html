<html>
<!-- Copyright 2010 andry.virvich@gmail.com. All Rights Reserved. -->
  <head>
	<script type="text/javascript" src="js/jquery-1.4.3.min.js"></script>
	<script type="text/javascript" src="js/jquery.xml.min.js"></script> 
    <script type="text/javascript" src="js/soapclient.js"></script>
	<script type="text/javascript" src="js/xsddate.js"></script>
    <script type="text/javascript" src="js/loader.js"></script>
	<script>

	function Auth(){
		chrome.browserAction.setBadgeBackgroundColor({color: [0, 255,0, 255]})
		if(localStorage.getItem("url"))
		{
			loader.url = localStorage.getItem("url");
			loader.login(localStorage.getItem("username"), localStorage.getItem("password"), function(){
				loader.update();
				window.setInterval(loader.update, localStorage.getItem('updateinterval'));
			});
		} else {
			browserAction.setIcon({ 'path' : 'images/16x16off.png'});
			chrome.browserAction.setBadgeText({text: ''});
		}
	}
	Auth();
	
			function AnimatedIcon(_src){
				this.src = _src;
				this.timer = null;
				this.canvas = document.createElement("canvas");
				document.body.appendChild(this.canvas);
				this.context = this.canvas.getContext('2d');
				this.image = new Image();
				this.image.src = this.src;
				chrome.browserAction.setIcon({path:this.src});
				var self = this;
				this.play = function(){
					this.deg = 0;
					this.timer = setInterval(function(){self.draw();}, 22);
				}
				this.draw = function(){
					this.context.clearRect(0, 0, this.image.width, this.image.height);
					this.context.translate(this.image.width/2,this.image.height/2);
					this.context.rotate(Math.PI * 15 / 180);
					this.context.translate(-this.image.width/2,-this.image.height/2);
					this.context.drawImage(this.image, 0, 0);
					chrome.browserAction.setIcon({
						imageData: this.context.getImageData(0, 0, this.image.width, this.image.height)
					});
					if((this.deg+=15) >= 360)
						this.stop();
				}
				
				this.stop = function(){
					clearInterval(this.timer);
					chrome.browserAction.setIcon({path:this.src});
				}
			}
			
	</script>
 </head>
  <body></body>
</html> 