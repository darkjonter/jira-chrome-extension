<!DOCTYPE html>
<html>
<!-- Copyright 2010 andry.virvich@gmail.com. All Rights Reserved. -->
<head>
  <title>JIRA Chrome Extension Options</title>
  <style type="text/css">
	.icon{
		width: 16px; height: 16px;
		margin: 0 4px;
		display: inline-block;
		background: url(images/counter.png)
	}
	.active #counter{
		background: url(images/counter.png)
	}
	.passive #counter{
		background: url(images/counter_gray.png)
	}
	.passive #counter:hover{
		background: url(images/counter.png)
	}

	#filters{
		border: 1px solid gray;
		background-color: #ffffff;
		padding: 4px;
	}
  </style>
	<script type="text/javascript" src="js/jquery-1.4.3.min.js"></script>
	<script type="text/javascript">
	var countedFilterId;
  function restoreOptions(){
	$("#username").attr("value",  localStorage.getItem('username'));
	$("#password").attr("value",  localStorage.getItem('password'));
	$("#url").attr("value",  (localStorage.getItem('url')?localStorage.getItem('url'):"http://jira.atlassian.com/"));
	var vals = [1, 3, 5, 10, 30, 60];
	var curval = parseInt(localStorage.getItem('updateinterval'))/(1000*60);
	$.map(vals,function(val){
		$("#updateinterval").append($("<OPTION "+((val == curval)?"SELECTED":'')+" />").attr("value", val).text(val));
	});
	
	var loader = chrome.extension.getBackgroundPage().loader;
	if(loader.filters.length){
		filters = [{id:0, name:"Assigned to me"}].concat(loader.filters);
		countedFilterId =  localStorage.getItem('countedFilterId');
		if(countedFilterId == null)
			countedFilterId = 0;
		$("#filters_row").show();
		for (i in filters){
			$("#filters").append(
				$("<div />").append(
					$("<div />").addClass("icon").attr("id", "counter")
				).append(
					$("<span />").text(filters[i].name)
				).addClass(function(){
					if(countedFilterId == filters[i].id)
						return "active";
					else
						return "passive";
				}).attr("filterid", filters[i].id).click(function(){
					if(countedFilterId.toString() != $(this).attr("filterid")){
						countedFilterId = $(this).attr("filterid");
						$(".active").toggleClass("active passive");
						$(this).toggleClass("active passive");
					}
				})
			);
		}
	}
	
  }
  function saveOptions(){

	localStorage.setItem('countedFilterId', countedFilterId);
	localStorage.setItem('username', $("#username").attr("value"));
	localStorage.setItem('password', $("#password").attr("value"));
	localStorage.setItem('url', $("#url").attr("value"));	
	localStorage.setItem('updateinterval', parseInt($("#updateinterval").attr("value"))*60000);
	chrome.extension.getBackgroundPage().Auth();
	alert("Settings was saved");
  }
  </script>
</head>

<body onload="restoreOptions()">
	<table style="width:100%;height:100%;">
		<tr>
			<td valign="center">
				<center>
				<font size="5" face="calibri, tahoma" color="#2e6eaf">JIRA Chrome Extension Options</font>
				<table style="border:8px solid #87b6d9; border-radius:10px; background-color:#e2e4ff;padding:15px;font-family: Calibri, tahoma">
				<tr>
					<td align="right">Username: </td>
					<td><input id="username" type="text" /></td>
				</tr>
				<tr>
					<td align="right">Password:</td>
					<td><input type="password" id="password" type="text" /></td>
				</tr>
				<tr>
					<td align="right">Jira URL:</td>
					<td><input id="url" type="text" /></td>
				</tr>
				<tr>
					<td align="right">Update Interval:</td>
					<td><select id="updateinterval" ></select>, min</td>
				<tr>
				<tr id="filters_row" style="display: hide;">
					<td align="right" valign="top">Filters:</td>
					<td id="filters"></td>
				<tr>				
				<tr>
					<td colspan="2" align="right"><hr/><input type="button" onclick="saveOptions();" value="Save Options" /></td>
				</tr>
				</table>
				</center>
			</td>
		</tr>
	</table>
</body>
</html>
